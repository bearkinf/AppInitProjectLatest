- [Android App Build Description Project](#android-app-build-description-project)
    - [최초 프로젝트 생성](#최초-프로젝트-생성)
        - [root/ .gitignore](#root-gitignore)
        - [root/settings.gradle](#rootsettingsgradle)
        - [root/build.gradle](#rootbuildgradle)
        - [root/app/build.gradle](#rootappbuildgradle)
    - [multiDexEnabled true](#multidexenabled-true)
    - [앱 파일 빌드 이름 생성](#앱-파일-빌드-이름-생성)
    - [앱 빌드 타입별 환경 설정.](#앱-빌드-타입별-환경-설정)
        - [buildConfig 파일 생성.](#buildconfig-파일-생성)
        - [빌드 타입별 서버 정보 변경](#빌드-타입별-서버-정보-변경)
        - [빌드 타입별 앱 이름 변경](#빌드-타입별-앱-이름-변경)
        - [Dependencies add](#dependencies-add)
            - [root/app/build.gradle](#rootappbuildgradle-1)
            - [Firebase 구성 파일 추가](#firebase-구성-파일-추가)

# Android App Build Description Project

---

* 앱 최신 버전에 따른 빌드 확인.

## 최초 프로젝트 생성

### root/ .gitignore

- 안드로이드 기본 .gitignore 사용하지 않음.

~~~ kotlin
# android create gitignore
#*.iml
#.gradle
#/local.properties
#/.idea/caches
#/.idea/libraries
#/.idea/modules.xml
#/.idea/workspace.xml
#/.idea/navEditor.xml
#/.idea/assetWizardSettings.xml
#.DS_Store
#/build
#/captures
#.externalNativeBuild
#.cxx
#local.properties
~~~

- 안드로이드 프로젝트에 커스텀된 .gitignore
- #Keystore files 추가하기 위해서 주석처리함.
- #*.jks
- #*.keystore

~~~ kotlin
# Created by https://www.toptal.com/developers/gitignore/api/androidstudio
# Edit at https://www.toptal.com/developers/gitignore?templates=androidstudio

### AndroidStudio ###
# Covers files to be ignored for android development using Android Studio.

# Built application files
*.apk
*.ap_
*.aab

# Files for the ART/Dalvik VM
*.dex

# Java class files
*.class

# Generated files
bin/
gen/
out/

# Gradle files
.gradle
.gradle/
build/

# Signing files
.signing/

# Local configuration file (sdk path, etc)
local.properties

# Proguard folder generated by Eclipse
proguard/

# Log Files
*.log

# Android Studio
/*/build/
/*/local.properties
/*/out
/*/*/build
/*/*/production
captures/
.navigation/
*.ipr
*~
*.swp

## Custom commit 
# Keystore files
#*.jks
#*.keystore

# Google Services (e.g. APIs or Firebase)
# google-services.json

# Android Patch
gen-external-apklibs

# External native build folder generated in Android Studio 2.2 and later
.externalNativeBuild

# NDK
obj/

# IntelliJ IDEA
*.iml
*.iws
/out/

# User-specific configurations
.idea/caches/
.idea/libraries/
.idea/shelf/
.idea/workspace.xml
.idea/tasks.xml
.idea/.name
.idea/compiler.xml
.idea/copyright/profiles_settings.xml
.idea/encodings.xml
.idea/misc.xml
.idea/modules.xml
.idea/scopes/scope_settings.xml
.idea/dictionaries
.idea/vcs.xml
.idea/jsLibraryMappings.xml
.idea/datasources.xml
.idea/dataSources.ids
.idea/sqlDataSources.xml
.idea/dynamic.xml
.idea/uiDesigner.xml
.idea/assetWizardSettings.xml
.idea/gradle.xml
.idea/jarRepositories.xml
.idea/navEditor.xml

# Legacy Eclipse project files
.classpath
.project
.cproject
.settings/

# Mobile Tools for Java (J2ME)
.mtj.tmp/

# Package Files #
*.war
*.ear

# virtual machine crash logs (Reference: http://www.java.com/en/download/help/error_hotspot.xml)
hs_err_pid*

## Plugin-specific files:

# mpeltonen/sbt-idea plugin
.idea_modules/

# JIRA plugin
atlassian-ide-plugin.xml

# Mongo Explorer plugin
.idea/mongoSettings.xml

# Crashlytics plugin (for Android Studio and IntelliJ)
com_crashlytics_export_strings.xml
crashlytics.properties
crashlytics-build.properties
fabric.properties

### AndroidStudio Patch ###

!/gradle/wrapper/gradle-wrapper.jar

# End of https://www.toptal.com/developers/gitignore/api/androidstudio
~~~

### root/settings.gradle

~~~ kotlin
pluginManagement {
    repositories {
        google()
        mavenCentral()
        gradlePluginPortal()
    }
}
dependencyResolutionManagement {
    repositoriesMode.set(RepositoriesMode.FAIL_ON_PROJECT_REPOS)
    repositories {
        google()
        mavenCentral()
    }
}
rootProject.name = "AppInitProjectLatest"
include ':app'
~~~

### root/build.gradle

~~~ kotlin
// Top-level build file where you can add configuration options common to all sub-projects/modules.
plugins {
    id 'com.android.application' version '8.0.2' apply false
    id 'com.android.library' version '8.0.2' apply false
    id 'org.jetbrains.kotlin.android' version '1.8.20' apply false
}
~~~

### root/app/build.gradle

~~~ kotlin
plugins {
    id 'com.android.application'
    id 'org.jetbrains.kotlin.android'
}

android {
    namespace 'com.bearkinf.appinitprojectlatest'
    compileSdk 33

    defaultConfig {
        applicationId "com.bearkinf.appinitprojectlatest"
        minSdk 23
        targetSdk 33
        versionCode 1
        versionName "1.0"

        testInstrumentationRunner "androidx.test.runner.AndroidJUnitRunner"
    }

    buildTypes {
        release {
            minifyEnabled false
            proguardFiles getDefaultProguardFile('proguard-android-optimize.txt'), 'proguard-rules.pro'
        }
    }
    compileOptions {
        sourceCompatibility JavaVersion.VERSION_1_8
        targetCompatibility JavaVersion.VERSION_1_8
    }
    kotlinOptions {
        jvmTarget = '1.8'
    }
}

dependencies {

    implementation 'androidx.core:core-ktx:1.8.0'
    implementation 'androidx.appcompat:appcompat:1.6.1'
    implementation 'com.google.android.material:material:1.5.0'
    implementation 'androidx.constraintlayout:constraintlayout:2.1.4'
    testImplementation 'junit:junit:4.13.2'
    androidTestImplementation 'androidx.test.ext:junit:1.1.5'
    androidTestImplementation 'androidx.test.espresso:espresso-core:3.5.1'
}
~~~

## multiDexEnabled true

- 메서드가 64K개를 초과하는 앱에 관해 멀티덱스 사용 설정
- https://developer.android.com/studio/build/multidex?hl=ko

~~~ kotlin
android {
    ...
    defaultConfig {
        ...     
        multiDexEnabled true
    }
}    
~~~

## 앱 빌드 타입별 환경 설정.

- Build Variants 에서 빌드 타입을 변경할 수 있다.

### BuildConfig 파일 생성.

- 최신 안드로이드 스튜디오에서 프로젝트 생성후 BuildConfig 파일이 생성이 안될 수 있다.
- root/app/build.gradle 안에서 처리.

~~~ kotlin
android {
    ...
    buildFeatures {
        // 파일 생성.
        buildConfig true
    }
}    
~~~

- root/gradle.properties 안에서 처리.

~~~ kotlin
android.defaults.buildfeatures.buildconfig=true # buildConfig 파일 생성 
~~~

### 앱 파일 빌드 이름 생성

- root/app/build.gradle 안 android{} 구문안에 삽입

~~~ kotlin
android {
    ...
    applicationVariants.all { variant ->

        variant.outputs.all {
            // def date = new Date()
            def formatterDayDate = new Date().format('yyyyMMdd')
            outputFileName = "${parent.project.getName()}-v${variant.versionName}-${formatterDayDate}-${variant.buildType.name}.apk"
            // parent.project.getName() = rootProject.name() //settings.gradle 안에 있음.
            // -v${variant.versionName} = android{ defaultConfig{}} 안에 versionName
            // formatteDaydDate = def 파일 변수 이름.
            // variant.buildType.name = android{ buildTpes{ }} 안에 빌드되는 타입이름.
     
        }
    }
}    
~~~

- run 과 build-> Rebuild Project 할때 위치가 다르다.
- run : root/app/build/intermediates/apk/debug/파일이름.apk
- Rebuild Project : root/app/build/outputs/apk/debug/파일이름.apk
- 안드로이드 에 apk 설치할때 run 에 만들어진 파일은 설치가 안된다.

### 빌드 타입별 서버 정보 변경

- buildConfigField "String", "BASE_URL", "\"https://www.daum.net\""
- 빌드 타입별로 필요한 환경변수들을 넣을 수 있다.전역변수 대체 가능(public static class 대체 가능.)

~~~ kotlin
android {
    ...
    buildTypes {
    
        release {
        buildConfigField "String", "BASE_URL", "\"https://www.naver.com\""
        }
        
        debug {
        buildConfigField "String", "BASE_URL", "\"https://www.daum.net\""
        }
    }        
}    
~~~

### 빌드 타입별 앱 이름 변경

- AndroidManifest.xml 안에 android:label="${appLabel}" 변경

~~~ kotlin
android {
    ...
    buildTypes {
    
        release {
            manifestPlaceholders = [appLabel: "releaseApp"]
            // string.xml에 정의한 이름으로 변경가능.
            // manifestPlaceholders.put("appLabel", "@string/app_name")
        }
        
        debug {
            manifestPlaceholders = [appLabel: "debugApp"]
            // string.xml에 정의한 이름으로 변경가능.
            // manifestPlaceholders.put("appLabel", "@string/app_name")
        }
    }       
}
~~~

## Gladle setting & dependencies add

- 빌드 종속 항목 추가 https://developer.android.com/studio/build/dependencies?hl=ko

### root/app/build.gradle

~~~ kotlin
plugins {
  id 'com.android.application'
}

android { ... }

dependencies {
    // 라이브러리 모듈 등록
    // root/settings.gradle 안에 모듈을 include 한다.
    //include 'myLibrary'
    // Dependency on a local library module
    implementation project(':mylibrary')

    // 라이브러리 모듈을 빌드하여 jar, aar 파일오 만들었을 경우. root/app/libs/ 폴더 안에 파일을 넣는다.
    // Dependency on local binaries
    // implementation fileTree(dir: 'libs', include: ['*.jar'])
    // implementation fileTree(dir: 'libs', include: ['*.aar'])
    implementation fileTree(dir: 'libs', include: ['*.jar','*.aar'])

    // 원격 바이너리 종속 항목 추가.
    // Dependency on a remote binary
    implementation 'com.example.android:app-magic:12.3'
}
~~~

### Firebase 구성 파일 추가

- 최신 버전에 따른 fcm 사용 https://firebase.google.com/docs/android/setup?authuser=0&%3Bhl=ko&hl=ko
- gradle 환경마다 다를 수 있다.

#### root/build.gradle

- 최초 빌드 시 생성된 build.gradle

~~~ kotlin
// Top-level build file where you can add configuration options common to all sub-projects/modules.
plugins {
    id 'com.android.application' version '8.0.2' apply false
    id 'com.android.library' version '8.0.2' apply false
    id 'org.jetbrains.kotlin.android' version '1.8.20' apply false
}
~~~

- 수정되는 root/build.gradle
- https://jgeun97.tistory.com/202 내용 참고

~~~ kotlin
buildscript {
    dependencies {
        // Add the dependency for the Google services Gradle plugin
        classpath 'com.google.gms:google-services:4.3.15'
    }
}
// Top-level build file where you can add configuration options common to all sub-projects/modules.
plugins {
    id 'com.android.application' version '8.0.2' apply false
    id 'com.android.library' version '8.0.2' apply false
    id 'org.jetbrains.kotlin.android' version '1.8.20' apply false
}
~~~

compileSdk, targetSdk, minSdk

순서...

gradle 설정.   
앱 빌드(디버그,릴리즈) 설정.

dependencies 추가.    
 